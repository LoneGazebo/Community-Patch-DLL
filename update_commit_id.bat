@echo off
SETLOCAL

set STATUS=Clean
for /f "usebackq delims=" %%i in (`git status --untracked-files^=no --porcelain`) do (
echo Uncommitted change^(s^): %%i
if [%%i] NEQ [] set STATUS=Dirty
)

for /f "usebackq delims=" %%i in (`git describe --abbrev^=0`) do set TAG=%%i
for /f "usebackq delims=" %%i in (`git rev-list --abbrev-commit -n 1 %TAG%`) do set TAGCOMMIT=%%i
for /f "usebackq delims=" %%i in (`git rev-list --abbrev-commit -n 1 HEAD`) do set HEADCOMMIT=%%i

if "%HEADCOMMIT%" == "%TAGCOMMIT%" (
echo const char CURRENT_GAMECORE_VERSION[] = "%TAG% %STATUS%"; //autogenerated, do not commit this file! > %~dp0%commit_id.inc
echo Version identifier will be "%TAG% %STATUS%"
)

if "%HEADCOMMIT%" NEQ "%TAGCOMMIT%" (
echo const char CURRENT_GAMECORE_VERSION[] = "%TAG% %HEADCOMMIT% %STATUS%"; //autogenerated, do not commit this file! > %~dp0%commit_id.inc
echo Version identifier will be "%TAG% %HEADCOMMIT% %STATUS%"
)

ENDLOCAL